<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Maze Game</title>
		<style type="text/css">
			
		</style>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, width=device-width, user-scalable=no" />
	</head>
	<body onload="startGame()">
		<canvas id="gameCanvas" width="0" height="0"></canvas>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js" type="text/javascript"></script>
		<script type="text/javascript">	
			
			var tilePositions = 
			{
				Tree1: 				{x:0, y:1},
				Tree2: 				{x:1, y:1},
				Tree3: 				{x:2, y:1},
				Tree4: 				{x:3, y:1},
				Tree5: 				{x:4, y:1},
				Tree6: 				{x:5, y:1},
				Tree7: 				{x:3, y:2},
				Tree0: 				{x:4, y:2},
				
				Coin:				{x:22, y:4},
				
				Chest:				{x:8, y:6},
				
				Empty:				{x:0, y:0}
			}
			
			var tileMapImg = new Image();
			tileMapImg.src = "tileset.png";
			var gameCanvas = document.getElementById("gameCanvas");
			var ctx = gameCanvas.getContext("2d");
			var chunkSize = 9;
			var chunksPerMap = 3;
			var mapSize = chunkSize * chunksPerMap;
			var tileSize = 32;
			var map;
			
			var emptySpaceBag = [];
			var emptySpaceBagIndex = 0;
			
			var emptyRoom_bitString = "TTTTETTTTTEEEEEEETTEEEEEEETTEEEEEEETEEEEEEEEETEEEEEEETTEEEEEEETTEEEEEEETTTTTETTTT";
			var target_bitStrip = "TTTTETTTTTEEEEEEETTETTTTTETTETEEETETEEEETEEEETETEEETETTETTTTTETTEEEEEEETTTTTETTTT";
			var hedge_bitStrip = "TTTTETTTTTETEEETETTEEETEEETTETEEETETEETTTTTEETETEEETETTEEETEEETTETEEETETTTTTETTTT";
			var pinwheel_bitStrip = "TTTTETTTTTEEEETEETTETTETTETTTTEEETETEEEEEEEEETETEEETTTTETTETTETTEETEEEETTTTTETTTT";
			var cross_bitStrip = "TTTTETTTTTEEEEEEETTEEETEEETTEEETEEETEETTTTTEETEEETEEETTEEETEEETTEEEEEEETTTTTETTTT";
			var butterfly_bitStrip = "TTTTETTTTTEETEEEETTEEEEEEETTTETTTETTEEETTTEEETTETTTETTTEEEEEEETTEETETEETTTTTETTTT";
			var ticTacToe_bitStrip = "TTTTETTTTTEEEEEEETTEETETEETTETTTTTETEEETTTEEETETTTTTETTEETETEETTEEEEEEETTTTTETTTT";
			var waves_bitStrip = "TTTTETTTTTEETEEEETTEEEETTETTTTEEETETEETETETEETETEEETTTTETTEEEETTEEEETEETTTTTETTTT";
			var gauntlet_bitStrip = "TTTTETTTTTEEEEEEETTETETTTETTETEEETETEETTTETEETETEEETETTETETTTETTETEEETETTTTTETTTT";
			var guillotine_bitStrip = "TTTTETTTTTEETETEETTEEEEEEETTETTETTETEEETETEEETETTETTETTETEEETETTEEEEEEETTTTTETTTT";
			var scarab_bitStrip = "TTTTETTTTTEEEEEEETTETETETETTETTTTTETEEETTTEEETETTTTTETTETETETETTEEEEEEETTTTTETTTT";
			var elephant_bitStrip = "TTTTETTTTTEEEEEEETTETTTETETTEETEETETEETTTTTEETETEETEETTETETTTETTEEEEEEETTTTTETTTT";
			var rosie_bitStrip = "TTTTETTTTTEEEEEEETTETTTTTETTETTTTTETEETTTTTEETETTTTTETTETTTTTETTEEEEEEETTTTTETTTT";
			var block_bitStrip = "TTTTETTTTTEEEEEEETTETTTTTETTETTTTTETEETTTTTEETETTTTTETTETTTTTETTEEEEEEETTTTTETTTT";
			var divide_bitStrip = "TTTTETTTTTEEEEEEETTETEEEEETTETTEEEETEEETTTEEETEEEETTETTEEEEETETTEEEEEEETTTTTETTTT";
			var pillars_bitStrip = "TTTTETTTTTEEEEEEETTETETETETTEEEEEEETEETETETEETEEEEEEETTETETETETTEEEEEEETTTTTETTTT";
			var moth_bitStrip = "TTTTETTTTTETEEETETTEEEEEEETTTEETEETTEEEETEEEETTEETEETTTEEEEEEETTETEEETETTTTTETTTT";
			var dub_bitStrip = "TTTTETTTTTEEEEEEETTETTETTETTETEEETETEETETETEETETETETETTETTTTTETTEEEEEEETTTTTETTTT";
			var ball_bitStrip = "TTTTETTTTTEEEEEEETTEETTTEETTETTTTTETEETTTTTEETETTTTTETTEETTTEETTEEEEEEETTTTTETTTT";
			
			var target_bitString = "";
			
			function randomMazeChunk()
			{
				var randInt = Math.floor(Math.random()*18);
				var bitString = "";
				switch(randInt)
				{
					case 0: return convertFromBitStringToChunk(rosie_bitStrip);
					case 1: return convertFromBitStringToChunk(target_bitStrip);
					case 2: return convertFromBitStringToChunk(hedge_bitStrip);
					case 3: return convertFromBitStringToChunk(pinwheel_bitStrip);
					case 4: return convertFromBitStringToChunk(scarab_bitStrip);
					case 5: return convertFromBitStringToChunk(cross_bitStrip);
					case 6: return convertFromBitStringToChunk(butterfly_bitStrip);
					case 7: return convertFromBitStringToChunk(ticTacToe_bitStrip);
					case 8: return convertFromBitStringToChunk(waves_bitStrip);
					case 9: return convertFromBitStringToChunk(gauntlet_bitStrip);
					case 10: return convertFromBitStringToChunk(guillotine_bitStrip);
					case 11: return convertFromBitStringToChunk(block_bitStrip);
					case 12: return convertFromBitStringToChunk(divide_bitStrip);
					case 13: return convertFromBitStringToChunk(pillars_bitStrip);
					case 14: return convertFromBitStringToChunk(moth_bitStrip);
					case 15: return convertFromBitStringToChunk(dub_bitStrip);
					case 16: return convertFromBitStringToChunk(ball_bitStrip);
					case 17: return convertFromBitStringToChunk(elephant_bitStrip);
					//default: return convertFromBitStringToChunk(guillotine_bitStrip);
				}
			}
			
			function convertFromBitStringToChunk(bitString)
			{
				var chunk = [];
				var bs = bitString;
				for (let i = 0; i < chunkSize; i++)
				{
					var row = [];
					for (let j = 0; j < chunkSize; j++)
					{
						var c = bs.charAt(0);
						bs = bs.substring(1);
						switch(c)
						{
							case "E":
								if (emptySpaceBagIndex >= emptySpaceBag.length)
								{
									emptySpaceBag = shuffle(emptySpaceBag);
									emptySpaceBagIndex = 0;
								}
								row.push(emptySpaceBag[emptySpaceBagIndex]);
								emptySpaceBagIndex++;
								break;
							case "T":
								var randInt = Math.floor(Math.random() * 8);
								row.push("Tree" + randInt);
								break;
							default:
								row.push("Empty");
								break;
						}
					}
					chunk.push(row);
				}
				return chunk;
			}
			
			function generateMap(type)
			{
				switch(type)
				{
					default:
					case "random maze":
						
						var arrayOfChunks = [];
						for (let i = 0; i < chunksPerMap; i++)
						{
							var rowOfChunks = [];
							for (let j = 0; j < chunksPerMap; j++)
							{
								var chunk = randomMazeChunk();
								rowOfChunks.push(chunk);
							}
							arrayOfChunks.push(rowOfChunks);		
						}
						
						var maze = [];
						for (let i = 0; i < arrayOfChunks.length * arrayOfChunks[0][0].length; i++)
						{
							var mazeRow = [];
							for (let j = 0; j < arrayOfChunks[0].length * arrayOfChunks[0][0][0].length; j++)
							{
								var row = Math.floor(i/chunkSize);
								var col = Math.floor(j/chunkSize);
								var chunkRow = j%chunkSize;
								var chunkCol = i%chunkSize; 
								mazeRow.push(arrayOfChunks[row][col][chunkRow][chunkCol]);
							}
							maze.push(mazeRow);
						}
						
						return maze;
				}
			}
			
			function buildStartingEmptySpaceBag()
			{
				var bag = [];
				for (let i = 0; i < 10; i++)	// 10 Empty
				{
					bag.push("Empty");
				}
				for (let i = 0; i < 5; i++)		// 5 Coins
				{
					bag.push("Coin");
				}
				for (let i = 0; i < 1; i++)		// 1 Chest
				{
					bag.push("Chest");
				}
				return bag;
			}
			
			function startGame()
			{
				gameCanvas.width = mapSize*tileSize;
				gameCanvas.height = mapSize*tileSize;
				
				emptySpaceBag = buildStartingEmptySpaceBag();
				
				map = generateMap("random maze");
				drawCanvas(map);
				
				emptySpaceBag = shuffle(emptySpaceBag);
			}
			
			function drawCanvas(map)
			{
				for (let i = 0; i < map.length; i++)
				{
					for (let j = 0; j < map[0].length; j++)
					{
						ctx.drawImage(
							tileMapImg,
							tilePositions[map[i][j]].x*(tileSize + 2),
							tilePositions[map[i][j]].y*(tileSize + 2),
							tileSize, tileSize,
							i*tileSize,
							j*tileSize,
							tileSize, tileSize
						);
					}
				}
			}
			
			
			
			function shuffle(array) { //from: https://stackoverflow.com/questions/2450954/how-to-randomize-shuffle-a-javascript-array
				var currentIndex = array.length, temporaryValue, randomIndex;

				// While there remain elements to shuffle...
				while (0 !== currentIndex) {

				// Pick a remaining element...
				randomIndex = Math.floor(Math.random() * currentIndex);
				currentIndex -= 1;

				// And swap it with the current element.
				temporaryValue = array[currentIndex];
				array[currentIndex] = array[randomIndex];
				array[randomIndex] = temporaryValue;
				}

				return array;
			}
			
			function sort_by_key(array, key) //from: https://stackoverflow.com/questions/8175093/simple-function-to-sort-an-array-of-objects/8175221#8175221
			{
			 return array.sort(function(a, b)
			 {
			  var x = a[key]; var y = b[key];
			  return ((x < y) ? -1 : ((x > y) ? 1 : 0));
			 });
			}
		</script>
	</body>
</html>
